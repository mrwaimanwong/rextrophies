
(function(a){a(document).ready(function(){a("[data-tooltip-title]").tooltip();setTimeout(function(){if(a("body.post-type-vpc-config").length>0){b()}n();h();a("#vpc-config-components-table > tbody").sortable({update:function(s,t){b()}});a(".wvpc-rules-table td.value select[data-selected]").each(function(){var s=a(this).data("selected");a(this).val(s)});i();q();k();o()},3000);a(document).on("change",".default-config",function(s){a(this).parents(".omodal-body").find("input[type=radio]").not(a(this)).attr("checked",false);n()});function n(){a("#vpc-preview").html("");a(".default-config:checked").each(function(){var s=a(this).closest(".vpc-option-row").find(".vpc-option-img img").attr("data-original");if(!s){s=a(this).closest(".vpc-option-row").find(".vpc-option-img img").attr("src")}if(s){a("#vpc-preview").append("<img src='"+s+"'>")}})}a(document).on("change",".wvpc_enable_conditional_logic",function(){if(a(this).is(":checked")){a(this).parents(".wvpc-conditional-logic-main-container").find(".wvpc-wvpc-conditional-logic-tr").show()}else{a(this).parents(".wvpc-conditional-logic-main-container").find(".wvpc-wvpc-conditional-logic-tr").hide()}});a(document).on("change",".wvpc-extraction-group-scope",function(v){var s=a(this).val();var w=a(this).parent().parent().find(".wvpc-extraction-group-apply_on");if(s=="option"){var u=r(wvpc_cond_rules_data.current_configuration.components,w.data("selected_option"));w.html(u)}else{if(s=="component"){var t=p(wvpc_cond_rules_data.current_configuration.components,w.data("selected_option"));w.html(t)}}});function r(t,u){var s="";if(t!=undefined){a.each(t,function(v,w){if(w.cname!==undefined&&w.options!==undefined){s+='<optgroup label="'+w.cname+'">';a.each(w.options,function(z,y){var A=" ";var x="";if(y.hasOwnProperty("option_id")&&y.option_id!=""){x=y.option_id}else{if(y.hasOwnProperty("name")){x="component_"+m(w.cname.replace(/ /g,""))+"_group_"+m(y.group.replace(/ /g,""))+"_option_"+m(y.name.replace(/ /g,""))}}if(u!=undefined&&u==x){A='selected="selected"'}s+='<option value="'+x+'"  '+A+">"+w.cname+" > "+y.name+"</option>"});s+="</optgroup>"}})}return s}function m(v){var u=[{re:/[\xC0-\xC6]/g,ch:"A"},{re:/[\xE0-\xE6]/g,ch:"a"},{re:/[\xC8-\xCB]/g,ch:"E"},{re:/[\xE8-\xEB]/g,ch:"e"},{re:/[\xCC-\xCF]/g,ch:"I"},{re:/[\xEC-\xEF]/g,ch:"i"},{re:/[\xD2-\xD6]/g,ch:"O"},{re:/[\xF2-\xF6]/g,ch:"o"},{re:/[\xD9-\xDC]/g,ch:"U"},{re:/[\xF9-\xFC]/g,ch:"u"},{re:/[\xC7-\xE7]/g,ch:"c"},{re:/[\xD1]/g,ch:"N"},{re:/[\xF1]/g,ch:"n"}];for(var t=0,s=u.length;t<s;t++){v=v.replace(u[t].re,u[t].ch)}return v.toLowerCase().replace(/\s+/g,"-").replace(/[^a-z0-9-]/g,"").replace(/\-{2,}/g,"-").replace(/^\-/g,"").replace(/\-$/,"")}function p(t,u){var s="";if(t!=undefined){a.each(t,function(w,y){if(y.cname!==undefined&&y.options!==undefined){var x=" ";if(y.hasOwnProperty("component_id")&&y.component_id!=""){var v=y.component_id}else{var v="component_"+m(y.cname.replace(/ /g,""))}if(u!=undefined&&u==v){x='selected="selected"'}s+='<option value="'+v+'" '+x+">"+y.cname+"</option>"}})}return s}function h(){if(a(".wvpc-conditional-rule-wrap").length>0){var u=wvpc_cond_rules_data.current_configuration.conditional_rules;if(u&&u.groups!=undefined){var v="";a.each(u.groups,function(w,y){var A=wvpc_cond_rules_data.wvpc_conditional_rule_tpl;var z="";if(typeof y.rules=="undefined"){return true}a.each(y.rules,function(B,D){var C=wvpc_cond_rules_data.wvpc_conditional_rule_tpl.replace(/{rule-index}/g,B);C=c(B,w,D,y.result);z+=C});var x=wvpc_cond_rules_data.wvpc_cl_group_container_tpl.replace(/{rule-group}/g,z).replace(/{enable-reverse-cb}/g,l(y,w));v+=d(x,w)});var t=a(".wvpc-rules-table-container").html();t=t.replace(/{rules-editor}/g,v);a(".wvpc-rules-table-container").html(t)}else{var s=c(0,0);s=wvpc_cond_rules_data.wvpc_cl_group_container_tpl.replace(/{rule-group}/g,s).replace(/{enable-reverse-cb}/g,l("",0));var t=a(".wvpc-rules-table-container").html();t=t.replace(/{rules-editor}/g,s);a(".wvpc-rules-table-container").html(t)}g();e()}}function d(u,t,s){if(u){if(t!=undefined){u=u.replace(/{rule-group-index}/g,t)}if(s!=undefined){u=u.replace(/{rule-index}/g,s)}}return u}function e(){var s=a(':input[name*="vpc-config["]').serializeJSON();wvpc_cond_rules_data.current_configuration=s["vpc-config"];a(".wvpc-extraction-group-option").each(function(){var t=r(wvpc_cond_rules_data.current_configuration.components,a(this).val());a(this).html(t)});a(".wvpc-extraction-group-apply_on").each(function(){var t=a(this).parents(".wvpc-rules-table-tr").find(".wvpc-extraction-group-scope").val();if(t=="option"){var u=r(wvpc_cond_rules_data.current_configuration.components,a(this).val());a(this).html(u)}else{if(t=="component"){var v=p(wvpc_cond_rules_data.current_configuration.components,a(this).val());a(this).html(v)}}});g()}function f(v,x,t,s,w){var u='<select name="'+v+'" id="'+x+'" class="'+t+'">';a.each(s,function(y,z){if(y==w){u+='<option value="'+y+'"  selected="selected" >'+z+"</option>"}else{u+='<option value="'+y+'">'+z+"</option>"}});u+="</select>";return u}function g(){a.each(a(".wvpc-shared-td"),function(t,s){var u=a(s).parents("table.wvpc-rules-table").find("tr").length;a(s).attr("rowspan",u)})}function c(C,v,y,z){var s="";if(C==0){s=wvpc_cond_rules_data.wvpc_conditional_rule_tpl_first_row}else{s=wvpc_cond_rules_data.wvpc_conditional_rule_tpl}var t=f("vpc-config[conditional_rules][groups][{rule-group-index}][rules][{rule-index}][trigger]","wvpc-group_{rule-group-index}_rule_{rule-index}_trigger","select wvpc-extraction-group-trigger",wvpc_cond_rules_data.wvpc_cl_trigger,(y)?y.trigger:"");var B=r(wvpc_cond_rules_data.current_configuration.components,(y)?y.option:"");var A=f("vpc-config[conditional_rules][groups][{rule-group-index}][result][scope]","wvpc-group_{rule-group-index}_rule_{rule-index}_scope","select wvpc-extraction-group-scope",wvpc_cond_rules_data.wvpc_cl_scope,(z)?z.scope:"");var w="";if(y&&z.scope&&z.scope=="component"){w=p(wvpc_cond_rules_data.current_configuration.components,(z)?z.apply_on:"")}else{w=r(wvpc_cond_rules_data.current_configuration.components,(z)?z.apply_on:"")}var x=f("vpc-config[conditional_rules][groups][{rule-group-index}][result][action]","wvpc-group_{rule-group-index}_rule_{rule-index}_action","select wvpc-extraction-group-action",wvpc_cond_rules_data.wvpc_cl_action,(z)?z.action:"");var u=s.replace(/{wvpc-extraction-group-trigger}/g,t);u=u.replace(/{wvpc-extraction-group-option}/g,B);u=u.replace(/{wvpc-extraction-group-scope}/g,A);u=u.replace(/{wvpc-extraction-group-action}/g,x);u=u.replace(/{wvpc-extraction-group-apply_on}/g,w);u=d(u,v,C);return u}function l(y,v){var u="";var x="";var t="";if(y.apply_reverse=="on"||y==""){u='checked="checked"'}if(y.conditions_relationship=="or"){x="selected"}else{t="selected"}var w='<div class="enable-reverse"><label for=""><input type="checkbox" name="vpc-config[conditional_rules][groups][{rule-group-index}][apply_reverse]" '+u+" />"+string_translations.reverse_cb_label+"</label> </div>";var s='<div class="vpc-conditions-relationship"><label for="">'+string_translations.group_conditions_relation+'<select name="vpc-config[conditional_rules][groups][{rule-group-index}][conditions_relationship]"><option value="and" '+t+'>AND</option><option value="or" '+x+">OR</option></select></label> </div>";return d(w+s,v)}a(document).on("click",".wvpc-add-rule",function(v){setTimeout(check_the_max_input_vars,200);var t=a(".wvpc-rules-table tr").length;var s=a(this).data("group");var u=c(t,s);a(this).parents(".wvpc-rules-table").find("tbody").append(u);g()});a(document).on("click",".wvpc-add-group",function(x){setTimeout(check_the_max_input_vars,200);var v=0;var s=a(".wvpc-rules-table-container .wvpc-rules-group-container").last().find(".wvpc-rules-table-tr").attr("data-id");s=parseInt(s.replace("rule_",""))+1;var w=c(v,s);var u=l("",s);var t=wvpc_cond_rules_data.wvpc_cl_group_container_tpl.replace(/{rule-group}/g,w);t=t.replace(/{enable-reverse-cb}/g,u);t=t.replace(/{rule-group-index}/g,s);t=t.replace(/{rule-index}/g,v);a(".wvpc-rules-table-container").append(t)});a(document).on("click",".wvpc-remove-rule",function(s){s.preventDefault();setTimeout(check_the_max_input_vars,200);a(this).parent().parent().remove()});a(".vpc-config-skin").change(function(){var t=a(this).val();var s=vpc_components_skins[t];a(".vpc-behaviour").html(s)});function b(){a("#vpc-config-components-table > tbody > tr").each(function(s,u){var t="vpc-config[components]["+s+"]";a(this).find(":input[name^='vpc-config[components]']").each(function(v,x){var w=this.name.replace(/vpc-config\[components\]\[\d+\]/,t);a(this).attr("name",w)})})}function j(){a(".o-modal .omodal-body>.table-fixed-layout> tbody > tr:visible").each(function(s,u){var t="[options]["+s+"]";a(this).find(":input[name*='[options]']").each(function(v,x){var w=this.name.replace(/\[options\]\[\d+\]/,t);a(this).attr("name",w)})})}function i(){a(".o-modal .table-fixed-layout>tbody").sortable({update:function(s,t){j()}})}a("#vpc-config-container>div>table>tbody>tr>td>.add-rf-row").click(function(){setTimeout(i,1000)});function q(){if(!a("#vpc-config-settings-box").length){return}var t=a("#vpc-config-settings-box").offset().left;var s=a("#vpc-config-settings-box").outerWidth();a("body").append("<style>.o-modal .omodal-dialog{width: "+s+"px;margin-left: "+t+"px;}</style")}function k(){a('.vpc-component-id[value=""]').each(function(s,t){var v=o_uniqid("component-");a(t).val(v);var u="component_"+m(a(t).parent().parent().find(".vpc-cname").val().replace(/ /g,""));a('option[value="'+u+'"]').attr("value",v)})}function o(){a('.vpc-option-id[value=""]').each(function(u,t){var s="component_"+m(a(t).parents(".omodal").parents().parents().find(".vpc-cname").val().replace(/ /g,""))+"_group_"+m(a(t).parents().parent().find(".vpc-option-group").val().replace(/ /g,""))+"_option_"+m(a(t).parent().parent().find(".vpc-option-name").val().replace(/ /g,""));var v=o_uniqid("option-");a('option[value="'+s+'"]').attr("value",v);a(t).val(v)})}a(document).on("change",".vpc-cname, .vpc-option-group, .vpc-option-name",function(){e()});a(document).on("click",".add-rf-row",function(s){setTimeout(function(){k();o()},200)})})})(jQuery);